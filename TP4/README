# TP4 : Real services
# Partie 1 : Partitionnement du serveur de stockage
## Partitionner le disque à l'aide de LVM
```
[elbatista@storage ~]$ lsblk
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda           8:0    0    8G  0 disk
├─sda1        8:1    0    1G  0 part
├─sda2        8:2    0    1G  0 part /boot
└─sda3        8:3    0    6G  0 part
  ├─rl-root 253:0    0  5.3G  0 lvm  /
  └─rl-swap 253:1    0  720M  0 lvm  [SWAP]
sdb           8:16   0    2G  0 disk
[elbatista@storage ~]$ sudo pvcreate /dev/sdb
  Physical volume "/dev/sdb" successfully created.
[elbatista@storage ~]$ sudo pvs
  Devices file sys_wwid t10.ATA_____VBOX_HARDDISK___________________________VB6b5dacc5-7e554ce8_ PVID EDEZ93dz8aQ9MFEqSnmUtqy87kJMwu4S last seen on /dev/sda3 not found.
  PV         VG Fmt  Attr PSize PFree
  /dev/sdb      lvm2 ---  2.00g 2.00g
  [elbatista@storage ~]$ sudo vgcreate storage /dev/sdb
  Volume group "storage" successfully created
[elbatista@storage ~]$ sudo vgs
  Devices file sys_wwid t10.ATA_____VBOX_HARDDISK___________________________VB6b5dacc5-7e554ce8_ PVID EDEZ93dz8aQ9MFEqSnmUtqy87kJMwu4S last seen on /dev/sda3 not found.
  VG      #PV #LV #SN Attr   VSize  VFree
  storage   1   0   0 wz--n- <2.00g <2.00g
[elbatista@storage ~]$ sudo lvcreate -l 100%FREE storage -n stovg
  Logical volume "stovg" created.
```
## Formater la partition
```
[elbatista@storage ~]$ sudo lvdisplay
  Devices file sys_wwid t10.ATA_____VBOX_HARDDISK___________________________VB6b5dacc5-7e554ce8_ PVID EDEZ93dz8aQ9MFEqSnmUtqy87kJMwu4S last seen on /dev/sda3 not found.
  --- Logical volume ---
  LV Path                /dev/storage/stovg
  LV Name                stovg
  VG Name                storage
  LV UUID                OszRo3-7Nxv-fAm6-aIwd-LfuD-s1QB-pq1365
  LV Write Access        read/write
  LV Creation host, time storage, 2022-12-13 11:17:00 +0100
  LV Status              available
  # open                 0
  LV Size                <2.00 GiB
  Current LE             511
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           253:2
[elbatista@storage ~]$ sudo  mkfs -t ext4 /dev/storage/stovg
mke2fs 1.46.5 (30-Dec-2021)
Creating filesystem with 523264 4k blocks and 130816 inodes
Filesystem UUID: a063669c-8ebb-4afa-9952-019a0fde8f16
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912

Allocating group tables: done
Writing inode tables: done
Creating journal (8192 blocks): done
Writing superblocks and filesystem accounting information: done
```

## Monter la partition

```
[elbatista@storage storage]$ mkdir montpart
[elbatista@storage storage]$ sudo mount /dev/storage/stovg /dev/storage/
montpart/
[elbatista@storage storage]$ df -h | grep storage
/dev/mapper/storage-stovg  2.0G   24K  1.9G   1% /dev/storage/montpart
[elbatista@storage storage]$ ls -al
total 4
drwxr-xr-x.  3 root root   80 Dec 13 11:32 .
drwxr-xr-x. 21 root root 3200 Dec 13 11:17 ..
drwxr-xr-x.  3 root root 4096 Dec 13 11:20 montpart
lrwxrwxrwx.  1 root root    7 Dec 13 11:20 stovg -> ../dm-2
[elbatista@storage etc]$ sudo nano fstab
[elbatista@storage etc]$ sudo cat fstab
[...]
/dev/storage/stovg     /dev/storage/montpart/                    ext4    defaults        0 0
```